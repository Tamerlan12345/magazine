<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–≤–æ–±–æ–¥–∞ –°–ª–æ–≤–∞ - –û—Ç–∑—ã–≤—ã</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .bg-dots-pattern {
            background-image: radial-gradient(circle, rgba(128, 128, 128, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .animate-fade-in {
            animation: fadeIn .5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen w-full flex items-center justify-center p-4 antialiased bg-dots-pattern">
    <div id="app-container" class="w-full">
        <div id="view-user-form" class="w-full">
            <div class="w-full max-w-2xl mx-auto bg-white dark:bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-2xl p-6 sm:p-8 relative">
                <div class="text-center mb-6">
                    <h1 class="text-4xl font-bold text-gray-800 dark:text-white tracking-tight">–°–≤–æ–±–æ–¥–∞ –°–ª–æ–≤–∞</h1>
                    <p class="text-gray-500 dark:text-gray-400 mt-2">–û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤ - –ø–æ–ª—É—á–∏—Ç–µ –±–∞–ª–ª—ã!</p>
                </div>

                <div class="flex justify-center items-center mb-8 space-x-2">
                    <div id="step-indicator-1" class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg transition-all duration-500 bg-indigo-600 text-white shadow-lg">1</div>
                    <div id="step-line-1" class="h-1 flex-1 transition-all duration-500 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                    <div id="step-indicator-2" class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg transition-all duration-500 bg-gray-200 dark:bg-gray-700 text-gray-500">2</div>
                    <div id="step-line-2" class="h-1 flex-1 transition-all duration-500 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                    <div id="step-indicator-3" class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg transition-all duration-500 bg-gray-200 dark:bg-gray-700 text-gray-500">3</div>
                </div>

                <div id="step-1" class="animate-fade-in">
                    <h2 class="font-bold text-xl text-center text-gray-800 dark:text-gray-200 mb-6">–®–∞–≥ 1: –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω</h2>
                    <div id="store-selection" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div>
                </div>

                <div id="step-2" class="hidden animate-fade-in">
                    <h2 class="font-bold text-xl text-center text-gray-800 dark:text-gray-200 mb-6">–®–∞–≥ 2: –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –æ—Ç–∑—ã–≤–∞</h2>
                    <div id="category-selection" class="space-y-4"></div>
                    <button id="back-to-step-1" class="mt-6 text-sm text-gray-500 dark:text-gray-400 hover:underline">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –º–∞–≥–∞–∑–∏–Ω–∞</button>
                </div>

                <div id="step-3" class="hidden animate-fade-in">
                    <h2 class="font-bold text-xl text-center text-gray-800 dark:text-gray-200 mb-2">–®–∞–≥ 3: –í–∞—à–∞ –º–∏—Å—Å–∏—è –∏ –æ—Ü–µ–Ω–∫–∞</h2>
                    <div id="mission-container"></div>
                    
                    <form name="reviews" id="review-form" class="space-y-5" netlify>
                        <input type="hidden" name="store" id="hidden-store-input">
                        <input type="hidden" name="category" id="hidden-category-input">
                        <input type="hidden" name="rating" id="hidden-rating-input">
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 text-center">–í–∞—à–∞ –æ–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <div id="rating-selection" class="flex justify-center gap-2 sm:gap-4"></div>
                        </div>
                        <textarea name="reviewText" id="reviewText-input" rows="5" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å..."></textarea>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <input type="text" name="name" id="name-input" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="–í–∞—à–µ –ò–º—è"/>
                             <input type="tel" name="phone" id="phone-input" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="–í–∞—à –¢–µ–ª–µ—Ñ–æ–Ω" />
                        </div>
                        
                        <div id="reward-container" class="text-center bg-green-50 dark:bg-green-900/30 text-green-800 dark:text-green-200 p-3 rounded-lg font-semibold"></div>
                        <p id="form-error" class="text-red-500 text-sm text-center hidden"></p>
                        <div class="flex items-center justify-between pt-4">
                            <button type="button" id="back-to-step-2" class="text-sm text-gray-500 dark:text-gray-400 hover:underline">‚Üê –ù–∞–∑–∞–¥</button>
                            <button type="submit" id="submit-review-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg focus:outline-none focus:shadow-outline transition-all duration-300 disabled:opacity-50 transform hover:scale-105">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
                        </div>
                    </form>
                </div>

                <div id="success-message" class="hidden animate-fade-in text-center">
                     <svg class="h-16 w-16 mx-auto text-green-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                     <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">–û—Ç–ª–∏—á–Ω–æ!</h2>
                     <p id="success-text" class="text-gray-600 dark:text-gray-400 mb-6"></p>
                     <button id="leave-another-review-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg">–û—Å—Ç–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–∏–Ω –æ—Ç–∑—ã–≤</button>
                </div>
            </div>
        </div>
    </div> 

<script type="module">
    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã ---
    const state = {
        currentStep: 1,
        selectedStore: '',
        selectedCategory: '',
        rating: null,
        rewardAmount: 150,
    };

    const STORES = ['Small', '–£ –î–æ–º–∞ –ú–∞—Ä—Ç', '–ù–∞—É—Ä—ã–∑'];
    const CATEGORIES = {
        '–û—Ü–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –º–∞–≥–∞–∑–∏–Ω–∞, –ø–µ—Ä—Å–æ–Ω–∞–ª–∞, –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è': `<svg class="h-6 w-6 mr-3 text-blue-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.649 14 6.42 14h9.16c.55 0 1-.45 1-1s-.45-1-1-1H6.42c-.57 0-.962-.38-1.08-.884l.158-.078L6.4 11h8.38a1 1 0 00.99-.83l1.57-7.35A1 1 0 0015.59 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" /></svg>`,
        '–û—Ü–µ–Ω–∏—Ç—å –≤–∫—É—Å–æ–≤—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–∞': `<svg class="h-6 w-6 mr-3 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`,
    };
    const RATINGS = [{ value: 1, emoji: 'üò°', label: '–£–∂–∞—Å–Ω–æ' }, { value: 2, emoji: 'üòû', label: '–ü–ª–æ—Ö–æ' }, { value: 3, emoji: 'üòê', label: '–ù–æ—Ä–º–∞–ª—å–Ω–æ' }, { value: 4, emoji: 'üôÇ', label: '–•–æ—Ä–æ—à–æ' }, { value: 5, emoji: 'ü§©', label: '–û—Ç–ª–∏—á–Ω–æ' }];
    const MISSIONS = {
        '–û—Ü–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –º–∞–≥–∞–∑–∏–Ω–∞, –ø–µ—Ä—Å–æ–Ω–∞–ª–∞, –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è': [
            "–û–ø–∏—à–∏—Ç–µ —á–∏—Å—Ç–æ—Ç—É –≤ –º–∞–≥–∞–∑–∏–Ω–µ –∏ —É–¥–æ–±—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤. –ß—Ç–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã —É–ª—É—á—à–∏—Ç—å?",
            "–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Ä–∞–±–æ—Ç—É –∫–∞—Å—Å–∏—Ä–æ–≤? –ë—ã–ª–∏ –ª–∏ –æ–Ω–∏ –≤–µ–∂–ª–∏–≤—ã –∏ –±—ã—Å—Ç—Ä—ã –≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏?",
            "–°—Ç–∞–ª–∫–∏–≤–∞–ª–∏—Å—å –ª–∏ –≤—ã —Å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º–∏ –≤ —Ç–æ—Ä–≥–æ–≤–æ–º –∑–∞–ª–µ? –ü–æ–º–æ–≥–ª–∏ –ª–∏ –æ–Ω–∏ –≤–∞–º —Å –≤—ã–±–æ—Ä–æ–º –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–º?",
            "–û—Ü–µ–Ω–∏—Ç–µ –æ–±—â—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –≤ –º–∞–≥–∞–∑–∏–Ω–µ. –ß—Ç–æ –≤–∞–º –∑–∞–ø–æ–º–Ω–∏–ª–æ—Å—å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ: –º—É–∑—ã–∫–∞, –∑–∞–ø–∞—Ö–∏, –æ—Å–≤–µ—â–µ–Ω–∏–µ?",
            "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–≤–æ–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–º –≤–∏–∑–∏—Ç–µ. –° –∫–∞–∫–∏–º–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å –∏–ª–∏, –Ω–∞–æ–±–æ—Ä–æ—Ç, —á—Ç–æ –≤–∞—Å –ø—Ä–∏—è—Ç–Ω–æ —É–¥–∏–≤–∏–ª–æ?"
        ],
        '–û—Ü–µ–Ω–∏—Ç—å –≤–∫—É—Å–æ–≤—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–∞': [
            "–ö—É–ø–∏—Ç–µ –∏ –æ–ø–∏—à–∏—Ç–µ –≤–∫—É—Å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π Coca-Cola. –ù–∞—Å–∫–æ–ª—å–∫–æ –æ–Ω —Å–ª–∞–¥–∫–∏–π, –≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π? –ß—É–≤—Å—Ç–≤—É–µ—Ç–µ –ª–∏ –≤—ã –ø–æ—Å–ª–µ–≤–∫—É—Å–∏–µ?",
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ Fanta. –û–ø–∏—à–∏—Ç–µ –µ–µ –∞—Ä–æ–º–∞—Ç –∏ –≤–∫—É—Å. –ù–∞—Å–∫–æ–ª—å–∫–æ –æ–Ω –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π, –ø–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é?",
            "–û—Ü–µ–Ω–∏—Ç–µ –≤–∫—É—Å –Ω–∞–ø–∏—Ç–∫–∞ Sprite. –ù–∞—Å–∫–æ–ª—å–∫–æ –æ–Ω –æ—Å–≤–µ–∂–∞–µ—Ç? –°—Ä–∞–≤–Ω–∏—Ç–µ –µ–≥–æ —Å –¥—Ä—É–≥–∏–º–∏ –ª–∏–º–æ–Ω–Ω—ã–º–∏ –≥–∞–∑–∏—Ä–æ–≤–∫–∞–º–∏.",
            "–û–ø–∏—à–∏—Ç–µ –≤–∫—É—Å–æ–≤—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –º–µ—Å—Ç–Ω–æ–≥–æ –ª–∏–º–æ–Ω–∞–¥–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, '–ë—É—Ä–∞—Ç–∏–Ω–æ'. –ö–∞–∫–∏–µ –Ω–æ—Ç–∫–∏ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ?",
            "–°—Ä–∞–≤–Ω–∏—Ç–µ –≤–∫—É—Å Pepsi –∏ Coca-Cola. –í —á–µ–º, –ø–æ-–≤–∞—à–µ–º—É, –∏—Ö –≥–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ? –ö–∞–∫–æ–π –Ω–∞–ø–∏—Ç–æ–∫ –≤–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –±–æ–ª—å—à–µ –∏ –ø–æ—á–µ–º—É?"
        ]
    };

    // --- –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º—ã ---
    const userForm = {
        step1: document.getElementById('step-1'),
        step2: document.getElementById('step-2'),
        step3: document.getElementById('step-3'),
        form: document.getElementById('review-form'),
        successMsg: document.getElementById('success-message'),

        init() {
            this.populateStores();
            this.populateCategories();
            this.populateRatings();
            document.getElementById('back-to-step-1').addEventListener('click', () => this.goToStep(1));
            document.getElementById('back-to-step-2').addEventListener('click', () => this.goToStep(2));
            document.getElementById('leave-another-review-btn').addEventListener('click', () => this.reset());
            this.form.addEventListener('submit', this.handleSubmit);
        },

        goToStep(step) {
            state.currentStep = step;
            [this.step1, this.step2, this.step3, this.successMsg].forEach(s => s.classList.add('hidden'));
            document.getElementById(`step-${step}`).classList.remove('hidden');

            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step-indicator-${i}`);
                const line = document.getElementById(`step-line-${i-1}`);
                if (i <= step) {
                    indicator.classList.add('bg-indigo-600', 'text-white', 'shadow-lg');
                    indicator.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-500');
                } else {
                    indicator.classList.remove('bg-indigo-600', 'text-white', 'shadow-lg');
                    indicator.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-500');
                }
                if (line) {
                     if (i <= step) {
                        line.classList.add('bg-indigo-600');
                        line.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                    } else {
                        line.classList.remove('bg-indigo-600');
                        line.classList.add('bg-gray-200', 'dark:bg-gray-700');
                    }
                }
            }
            if (step === 3) {
                this.generateMission();
            }
        },

        populateStores() {
            const container = document.getElementById('store-selection');
            container.innerHTML = '';
            STORES.forEach(store => {
                const button = document.createElement('button');
                button.textContent = store;
                button.className = "p-6 bg-gray-50 dark:bg-gray-700/50 rounded-xl text-lg font-semibold text-gray-800 dark:text-gray-200 hover:bg-white dark:hover:bg-gray-700 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 border border-gray-200 dark:border-gray-700";
                button.onclick = () => {
                    state.selectedStore = store;
                    this.goToStep(2);
                };
                container.appendChild(button);
            });
        },

        populateCategories() {
            const container = document.getElementById('category-selection');
            container.innerHTML = '';
            Object.entries(CATEGORIES).forEach(([name, icon]) => {
                const button = document.createElement('button');
                button.innerHTML = `${icon}<span>${name}</span>`;
                button.className = "w-full flex items-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl text-lg text-gray-800 dark:text-gray-200 hover:bg-white dark:hover:bg-gray-700 transition-colors duration-300 border border-gray-200 dark:border-gray-700";
                button.onclick = () => {
                    state.selectedCategory = name;
                    this.goToStep(3);
                };
                container.appendChild(button);
            });
        },

        populateRatings() {
             const container = document.getElementById('rating-selection');
             container.innerHTML = '';
             RATINGS.forEach(r => {
                 const button = document.createElement('button');
                 button.type = 'button';
                 button.dataset.value = r.value;
                 button.innerHTML = `<span class="text-3xl">${r.emoji}</span><span class="text-xs mt-1 font-semibold text-gray-600 dark:text-gray-300">${r.label}</span>`;
                 button.className = 'flex flex-col items-center p-2 rounded-xl transition-all duration-200 w-1/5 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600';
                 button.onclick = () => {
                     state.rating = r.value;
                     container.childNodes.forEach(child => {
                         child.classList.remove('bg-indigo-600', 'text-white', 'shadow-lg', 'scale-110');
                         child.querySelector('span:last-child').classList.remove('text-white');
                         child.querySelector('span:last-child').classList.add('text-gray-600', 'dark:text-gray-300');
                     });
                     button.classList.add('bg-indigo-600', 'text-white', 'shadow-lg', 'scale-110');
                     button.querySelector('span:last-child').classList.add('text-white');
                     button.querySelector('span:last-child').classList.remove('text-gray-600', 'dark:text-gray-300');
                 };
                 container.appendChild(button);
             });
        },
        
        generateMission() {
            const container = document.getElementById('mission-container');
            const missionList = MISSIONS[state.selectedCategory];
            let missionText = "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∞—à–µ–º –≤–∏–∑–∏—Ç–µ. –ß—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –∏–ª–∏ –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å?";
            
            if(missionList && missionList.length > 0) {
                const randomIndex = Math.floor(Math.random() * missionList.length);
                missionText = missionList[randomIndex];
            }

            container.innerHTML = `<div class="bg-indigo-50 dark:bg-indigo-900/40 p-4 rounded-xl mb-6 text-center border border-indigo-200 dark:border-indigo-800"><div class="flex justify-center text-yellow-400 mb-2"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8-2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg></div><p class="text-indigo-800 dark:text-indigo-200 font-medium">${missionText}</p></div>`;
            document.getElementById('reward-container').textContent = `–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ ${state.rewardAmount} ‚Ç∏ –Ω–∞ Kaspi`;
        },

        handleSubmit: async (e) => {
            e.preventDefault();
            const formError = document.getElementById('form-error');
            const submitBtn = document.getElementById('submit-review-btn');
            
            const reviewText = document.getElementById('reviewText-input').value;
            const name = document.getElementById('name-input').value;
            const phone = document.getElementById('phone-input').value;

            if (!reviewText || !name || !phone || !state.rating) {
                formError.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É.';
                formError.classList.remove('hidden');
                return;
            }
            formError.classList.add('hidden');
            submitBtn.disabled = true;
            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

            document.getElementById('hidden-store-input').value = state.selectedStore;
            document.getElementById('hidden-category-input').value = state.selectedCategory;
            document.getElementById('hidden-rating-input').value = state.rating;
            
            const formData = new FormData(userForm.form);

            try {
                await fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString(),
                });
                userForm.showSuccess();
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Netlify: ", error);
                formError.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ.';
                formError.classList.remove('hidden');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤';
            }
        },

        showSuccess() {
            document.getElementById('success-text').textContent = `–°–ø–∞—Å–∏–±–æ! –í–∞—à –æ—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.`;
            [this.step1, this.step2, this.step3].forEach(s => s.classList.add('hidden'));
            this.successMsg.classList.remove('hidden');
        },

        reset() {
            this.successMsg.classList.add('hidden');
            this.form.reset();
            state.rating = null;
            this.populateRatings();
            this.goToStep(1);
        }
    };

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
    window.onload = () => {
        userForm.init();
    };
</script>
</body>
</html>
