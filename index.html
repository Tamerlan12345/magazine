<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–≤–æ–±–æ–¥–∞ –°–ª–æ–≤–∞ - –û—Ç–∑—ã–≤—ã</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .bg-dots-pattern { background-image: radial-gradient(circle, rgba(128, 128, 128, 0.1) 1px, transparent 1px); background-size: 20px 20px; }
        .animate-fade-in { animation: fadeIn .5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen w-full flex items-center justify-center p-4 antialiased bg-dots-pattern">
    <div id="app-container" class="w-full">
        <div id="view-user-form" class="w-full">
            <div class="w-full max-w-2xl mx-auto bg-white dark:bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-2xl p-6 sm:p-8 relative">
                <div class="text-center mb-6">
                    <h1 class="text-4xl font-bold text-gray-800 dark:text-white tracking-tight">–°–≤–æ–±–æ–¥–∞ –°–ª–æ–≤–∞</h1>
                    <p class="text-gray-500 dark:text-gray-400 mt-2">–û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤ - –ø–æ–ª—É—á–∏—Ç–µ –±–∞–ª–ª—ã!</p>
                </div>

                <div class="flex justify-center items-center mb-8 space-x-2">
                    <div id="step-indicator-1" class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg transition-all duration-500 bg-indigo-600 text-white shadow-lg">1</div>
                    <div id="step-line-1" class="h-1 flex-1 transition-all duration-500 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                    <div id="step-indicator-2" class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg transition-all duration-500 bg-gray-200 dark:bg-gray-700 text-gray-500">2</div>
                    <div id="step-line-2" class="h-1 flex-1 transition-all duration-500 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                    <div id="step-indicator-3" class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg transition-all duration-500 bg-gray-200 dark:bg-gray-700 text-gray-500">3</div>
                </div>

                <div id="step-1" class="animate-fade-in"><h2 class="font-bold text-xl text-center text-gray-800 dark:text-gray-200 mb-6">–®–∞–≥ 1: –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω</h2><div id="store-selection" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div></div>
                <div id="step-2" class="hidden animate-fade-in"><h2 class="font-bold text-xl text-center text-gray-800 dark:text-gray-200 mb-6">–®–∞–≥ 2: –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –æ—Ç–∑—ã–≤–∞</h2><div id="category-selection" class="space-y-4"></div><button id="back-to-step-1" class="mt-6 text-sm text-gray-500 dark:text-gray-400 hover:underline">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –º–∞–≥–∞–∑–∏–Ω–∞</button></div>

                <div id="step-3" class="hidden animate-fade-in">
                    <h2 class="font-bold text-xl text-center text-gray-800 dark:text-gray-200 mb-2">–®–∞–≥ 3: –í–∞—à–∞ –º–∏—Å—Å–∏—è –∏ –æ—Ü–µ–Ω–∫–∞</h2>
                    <div id="mission-container"></div>
                    
                    <form id="review-form" class="space-y-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 text-center">–í–∞—à–∞ –æ–±—â–∞—è –æ—Ü–µ–Ω–∫–∞</label>
                            <div id="rating-selection" class="flex justify-center gap-2 sm:gap-4"></div>
                        </div>
                        <textarea name="review_text" id="reviewText-input" rows="5" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å..."></textarea>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                             <input type="text" name="name" id="name-input" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="–í–∞—à–µ –ò–º—è"/>
                             <input type="tel" name="phone" id="phone-input" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="–í–∞—à –¢–µ–ª–µ—Ñ–æ–Ω" />
                             <input type="email" name="email" id="email-input" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="–í–∞—à Email"/>
                        </div>
                        
                        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md">
                            <div class="space-y-1 text-center">
                                <img id="photo-preview" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ" class="max-h-40 mx-auto rounded-md shadow hidden"/>
                                <svg id="photo-placeholder-icon" class="mx-auto h-12 w-12 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>
                                <div class="flex text-sm text-gray-600 justify-center">
                                    <label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500">
                                        <span>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ</span>
                                        <input id="file-upload" name="attachment" type="file" class="sr-only" accept="image/*" required/>
                                    </label>
                                </div>
                                <p class="text-xs text-gray-500">PNG, JPG –¥–æ 10MB</p>
                            </div>
                        </div>

                        <div id="reward-container" class="text-center bg-green-50 text-green-800 p-3 rounded-lg font-semibold"></div>
                        <p id="form-error" class="text-red-500 text-sm text-center hidden"></p>
                        <div class="flex items-center justify-between pt-4">
                            <button type="button" id="back-to-step-2" class="text-sm text-gray-500 hover:underline">‚Üê –ù–∞–∑–∞–¥</button>
                            <button type="submit" id="submit-review-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg focus:outline-none focus:shadow-outline transition-all duration-300 disabled:opacity-50 transform hover:scale-105">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
                        </div>
                    </form>
                </div>

                <div id="success-message" class="hidden animate-fade-in text-center">
                     <svg class="h-16 w-16 mx-auto text-green-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                     <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">–û—Ç–ª–∏—á–Ω–æ!</h2>
                     <p id="success-text" class="text-gray-600 dark:text-gray-400 mb-6"></p>
                     <button id="leave-another-review-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg">–û—Å—Ç–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–∏–Ω –æ—Ç–∑—ã–≤</button>
                </div>
            </div>
        </div>
    </div> 

<script type="module">
    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã ---
    const state = { currentStep: 1, selectedStore: '', selectedCategory: '', rating: null, rewardAmount: 150 };
    const STORES = ['Small', '–£ –î–æ–º–∞ –ú–∞—Ä—Ç', '–ù–∞—É—Ä—ã–∑'];
    const CATEGORIES = {
        '–û—Ü–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –º–∞–≥–∞–∑–∏–Ω–∞, –ø–µ—Ä—Å–æ–Ω–∞–ª–∞, –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è': `<svg class="h-6 w-6 mr-3 text-blue-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.649 14 6.42 14h9.16c.55 0 1-.45 1-1s-.45-1-1-1H6.42c-.57 0-.962-.38-1.08-.884l.158-.078L6.4 11h8.38a1 1 0 00.99-.83l1.57-7.35A1 1 0 0015.59 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" /></svg>`,
        '–û—Ü–µ–Ω–∏—Ç—å –≤–∫—É—Å–æ–≤—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–∞': `<svg class="h-6 w-6 mr-3 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`,
    };
    const RATINGS = [{ value: 1, emoji: 'üò°', label: '–£–∂–∞—Å–Ω–æ' }, { value: 2, emoji: 'üòû', label: '–ü–ª–æ—Ö–æ' }, { value: 3, emoji: 'üòê', label: '–ù–æ—Ä–º–∞–ª—å–Ω–æ' }, { value: 4, emoji: 'üôÇ', label: '–•–æ—Ä–æ—à–æ' }, { value: 5, emoji: 'ü§©', label: '–û—Ç–ª–∏—á–Ω–æ' }];
    const MISSIONS = {
        '–û—Ü–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –º–∞–≥–∞–∑–∏–Ω–∞, –ø–µ—Ä—Å–æ–Ω–∞–ª–∞, –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è': ["–û–ø–∏—à–∏—Ç–µ —á–∏—Å—Ç–æ—Ç—É –∏ —É–¥–æ–±—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤.", "–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Ä–∞–±–æ—Ç—É –∫–∞—Å—Å–∏—Ä–æ–≤?", "–ü–æ–º–æ–≥–ª–∏ –ª–∏ –≤–∞–º –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã –≤ –∑–∞–ª–µ?",],
        '–û—Ü–µ–Ω–∏—Ç—å –≤–∫—É—Å–æ–≤—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–∞': ["–û–ø–∏—à–∏—Ç–µ –≤–∫—É—Å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π Coca-Cola.", "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ Fanta –∏ –æ–ø–∏—à–∏—Ç–µ –µ–µ –≤–∫—É—Å.", "–ù–∞—Å–∫–æ–ª—å–∫–æ –æ—Å–≤–µ–∂–∞–µ—Ç Sprite?",]
    };

    // --- –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º—ã ---
    const userForm = {
        step1: document.getElementById('step-1'),
        step2: document.getElementById('step-2'),
        step3: document.getElementById('step-3'),
        form: document.getElementById('review-form'),
        successMsg: document.getElementById('success-message'),
        
        init() {
            this.populateStores(); this.populateCategories(); this.populateRatings();
            document.getElementById('back-to-step-1').addEventListener('click', () => this.goToStep(1));
            document.getElementById('back-to-step-2').addEventListener('click', () => this.goToStep(2));
            document.getElementById('leave-another-review-btn').addEventListener('click', () => this.reset());
            document.getElementById('file-upload').addEventListener('change', this.handlePhotoChange);
            this.form.addEventListener('submit', this.handleSubmit);
        },
        goToStep(step) {
            [this.step1, this.step2, this.step3, this.successMsg].forEach(s => { if(s) s.classList.add('hidden'); });
            const currentStepEl = document.getElementById(`step-${step}`);
            if(currentStepEl) currentStepEl.classList.remove('hidden');
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step-indicator-${i}`); const line = document.getElementById(`step-line-${i-1}`);
                if (indicator) { if (i <= step) { indicator.classList.add('bg-indigo-600', 'text-white'); indicator.classList.remove('bg-gray-200', 'text-gray-500'); } else { indicator.classList.remove('bg-indigo-600', 'text-white'); indicator.classList.add('bg-gray-200', 'text-gray-500'); } }
                if (line) { if (i <= step) { line.classList.add('bg-indigo-600'); line.classList.remove('bg-gray-200'); } else { line.classList.remove('bg-indigo-600'); line.classList.add('bg-gray-200'); } }
            }
            if (step === 3) this.generateMission();
        },
        populateStores() { const container = document.getElementById('store-selection'); if (!container) return; container.innerHTML = ''; STORES.forEach(store => { const button = document.createElement('button'); button.type = 'button'; button.textContent = store; button.className = "p-6 bg-gray-50 rounded-xl text-lg font-semibold text-gray-800 hover:bg-white hover:shadow-lg transition-all"; button.onclick = () => { state.selectedStore = store; this.goToStep(2); }; container.appendChild(button); }); },
        populateCategories() { const container = document.getElementById('category-selection'); if (!container) return; container.innerHTML = ''; Object.entries(CATEGORIES).forEach(([name, icon]) => { const button = document.createElement('button'); button.type = 'button'; button.innerHTML = `${icon}<span>${name}</span>`; button.className = "w-full flex items-center p-4 bg-gray-50 rounded-xl text-lg text-gray-800 hover:bg-white transition-colors"; button.onclick = () => { state.selectedCategory = name; this.goToStep(3); }; container.appendChild(button); }); },
        populateRatings() {
             const container = document.getElementById('rating-selection'); if (!container) return; container.innerHTML = '';
             RATINGS.forEach(r => { const button = document.createElement('button'); button.type = 'button'; button.dataset.value = r.value; button.innerHTML = `<span class="text-3xl">${r.emoji}</span><span class="text-xs mt-1 font-semibold text-gray-600">${r.label}</span>`; button.className = 'flex flex-col items-center p-2 rounded-xl transition-all w-1/5 bg-gray-100 hover:bg-gray-200'; button.onclick = () => { state.rating = r.value; container.childNodes.forEach(child => { child.classList.remove('bg-indigo-600', 'text-white', 'scale-110'); child.querySelector('span:last-child').classList.remove('text-white'); child.querySelector('span:last-child').classList.add('text-gray-600'); }); button.classList.add('bg-indigo-600', 'text-white', 'scale-110'); button.querySelector('span:last-child').classList.add('text-white'); }; container.appendChild(button); });
        },
        generateMission() {
            const container = document.getElementById('mission-container'); if (!container) return;
            const missionList = MISSIONS[state.selectedCategory] || []; let missionText = missionList.length > 0 ? missionList[Math.floor(Math.random() * missionList.length)] : "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∞—à–µ–º –≤–∏–∑–∏—Ç–µ.";
            container.innerHTML = `<div class="bg-indigo-50 p-4 rounded-xl mb-6 text-center border"><p class="text-indigo-800 font-medium">${missionText}</p></div>`;
            const rewardEl = document.getElementById('reward-container'); if(rewardEl) rewardEl.textContent = `–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ ${state.rewardAmount} ‚Ç∏ –Ω–∞ Kaspi`;
        },
        handlePhotoChange(e) {
            const file = e.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onloadend = () => { document.getElementById('photo-preview').src = reader.result; document.getElementById('photo-preview').classList.remove('hidden'); document.getElementById('photo-placeholder-icon').classList.add('hidden'); };
            reader.readAsDataURL(file);
        },

        handleSubmit: async (e) => {
            e.preventDefault();
            const form = e.target;
            const formError = document.getElementById('form-error');
            const submitBtn = document.getElementById('submit-review-btn');
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –æ–±—ä–µ–∫—Ç FormData. –û–Ω —Å–∞–º –Ω–∞–π–¥–µ—Ç –≤—Å–µ –ø–æ–ª—è, –≤–∫–ª—é—á–∞—è —Ñ–∞–π–ª.
            const formData = new FormData(form);

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–∞—à–µ–≥–æ JS-—Å–æ—Å—Ç–æ—è–Ω–∏—è
            formData.append('store', state.selectedStore);
            formData.append('category', state.selectedCategory);
            formData.append('rating', state.rating ? `${state.rating}/5 (${RATINGS.find(r => r.value === state.rating).label})` : '–ù–µ—Ç –æ—Ü–µ–Ω–∫–∏');

            // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
            if (!formData.get('review_text') || !formData.get('name') || !formData.get('phone') || !formData.get('email') || !state.rating || !formData.get('attachment').size) {
                formError.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ.';
                formError.classList.remove('hidden');
return;
            }
            
            formError.classList.add('hidden');
            submitBtn.disabled = true;
            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

            try {
                const response = await fetch('https://formspree.io/f/mnnvwpqj', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    },
                });

                if (response.ok) {
                    userForm.showSuccess();
                } else {
                    const responseData = await response.json();
                    const errorMessage = responseData.errors?.map(err => err.message).join(', ') || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.';
                    throw new Error(`–û—à–∏–±–∫–∞: ${errorMessage}`);
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Formspree: ", error);
                formError.textContent = `–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ${error.message}`;
                formError.classList.remove('hidden');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤';
            }
        },

        showSuccess() {
            document.getElementById('success-text').textContent = `–°–ø–∞—Å–∏–±–æ! –í–∞—à –æ—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.`;
            [this.step1, this.step2, this.step3].forEach(s => s.classList.add('hidden'));
            this.successMsg.classList.remove('hidden');
        },

        reset() {
            this.successMsg.classList.add('hidden');
            this.form.reset();
            state.rating = null;
            document.getElementById('photo-preview').src = '';
            document.getElementById('photo-preview').classList.add('hidden');
            document.getElementById('photo-placeholder-icon').classList.remove('hidden');
            this.populateRatings();
            this.goToStep(1);
        },
    };

    window.onload = () => { userForm.init(); };
</script>
</body>
</html>
